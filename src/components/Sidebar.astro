---
// src/components/Sidebar.astro
// REVISED: Dynamic data + Correct Tailwind classes

import { getCollection } from 'astro:content';
import CardVertical from './cards/CardVertical.astro';

// 1. Fetch all blog posts dynamically
const allPosts = await getCollection('blog');

// 2. Sort by Date (Newest First) and take the top 4
const recentStories = allPosts
  .sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf())
  .slice(0, 4);
---

<aside class="space-y-8">
  
  <div class="hidden md:block relative">
    <form action="/search" method="GET">
      <label for="sidebar-search-article" class="sr-only">Search</label>
      <div class="relative">
        <input 
          id="sidebar-search-article"
          type="search" 
          name="q"
          placeholder="Search..."
          class="w-full px-4 py-3 border border-divider rounded-md focus:ring-2 focus:ring-primary focus:outline-none"
        />
        <button type="submit" class="absolute right-0 top-0 h-full px-4 text-muted hover:text-primary" aria-label="Submit search">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </button>
      </div>
    </form>
  </div>
  
  <div>
    <h3 class="font-merri font-bold text-xl text-primary mb-4">Recent Stories</h3>
    <div class="space-y-6">
      {recentStories.map(story => (
        <CardVertical
          href={`/blog/${story.slug}/`}
          imgSrc={story.data.heroImage}
          category={story.data.category}
          title={story.data.title}
          date={story.data.date}
          readTime={story.readingTime}
        />
      ))}
    </div>
  </div>

  <div class="space-y-4">
    <div class="bg-background-alt h-48 rounded-md flex items-center justify-center text-muted font-bold">
      Advertising (360px * 180px)
    </div>
    <div class="bg-background-alt h-48 rounded-md flex items-center justify-center text-muted font-bold">
      Advertising (360px * 180px)
    </div>
  </div>

</aside>