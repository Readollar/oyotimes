---
// src/components/Header.astro
// REVISED: Fixed mobile scrolling issue

const { activeId = "home" } = Astro.props;

const navItems = [
  { name: "Home", href: "/", id: "home" },
  { name: "Business", href: "/category/business", id: "business" },
  { name: "Politics", href: "/category/politics", id: "politics" },
  { name: "Tech", href: "/category/tech", id: "tech" },
  { name: "Education", href: "/category/education", id: "education" },
  { name: "Sports", href: "/category/sports", id: "sports" },
  { name: "Events", href: "/events", id: "events" },
  { name: "Places", href: "/places", id: "places" },
  { name: "Voices", href: "/community", id: "community" },
  { name: "The Palace", href: "/monarch", id: "monarch" },
];

const dropdownItems = [
  { name: "About", href: "/about", id: "about" },
  { name: "Bookmarks", href: "/bookmarks", id: "bookmarks" },
  { name: "Submit Article", href: "/submit", id: "submit" },
  { name: "Search Site", href: "/search", id: "search" },
];

const isDropdownActive = dropdownItems.some(item => item.id === activeId);
---

<header class="oy-header w-full" role="banner" id="main-header">
  
  <div class="container head-bar">
    <div class="head-inner">
      
      <div class="date-left" aria-hidden="false">
        <img src="/icons/icon-world.svg" alt="" class="icon-world" />
        <span id="oy-current-date" class="date-text">Loading date...</span>
      </div>
      
      <a href="/" class="brand">
        <img src="/img/logos/logo-full.svg" alt="OyoTimes" class="brand-logo" />
      </a>
      
      <div class="right-actions">
        <a href="/submit" class="utility-link">Submit Your Story</a>
        
        <button class="hamburger" id="oy-hamburger" aria-label="Open menu" aria-expanded="false">
          <span></span><span></span><span></span>
        </button>
      </div>

    </div>
  </div>
  

  <div class="nav-band bg-background-alt border-y border-border-divider hidden md:block relative z-40 " id="oy-nav-band">
    <div class="container py-0">
      <nav class="main-nav">
        <ul class="nav-list flex justify-center gap-6 text-sm uppercase tracking-wider m-0 list-none">
          {navItems.map(item => (
            <li class={`nav-item ${item.id === activeId ? 'active' : ''}`}>
              <a href={item.href} class={`text-text-primary block py-3 no-underline transition-colors ${item.id === activeId ? 'text-text-link font-bold' : ' hover:text-text-link'}`}>
                {item.name}
              </a>
            </li>
          ))}

          <li class={`nav-item dropdown-container relative group ${isDropdownActive ? 'active' : ''}`}>
            <a href="#" class="flex items-center gap-1 py-3 cursor-pointer text-text-primary hover:text-text-link" onclick="event.preventDefault();">
              More <span>&darr;</span>
            </a>
            <ul class="dropdown-menu absolute top-full left-0 hidden group-hover:block bg-background-primary shadow-lg border border-divider min-w-[200px] z-50 p-2 m-0 list-none rounded-b-md normal-case">
              {dropdownItems.map(item => (
                <li>
                  <a href={item.href} class="block px-4 py-2 text-text-primary hover:bg-background-alt hover:text-text-link">{item.name}</a>
                </li>
              ))}
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <div id="mobile-menu" class="hidden fixed left-0 right-0 bottom-0 bg-background-primary z-50 overflow-y-auto border-t border-divider">
    <nav class="container py-4">
      <ul class="flex flex-col gap-0 list-none m-0 px-5 uppercase font-bold text-text-primary text-lg">
        {navItems.map(item => (
          <li>
            <a href={item.href} class="block text-text-primary py-4 border-b border-border-divider hover:text-text-link">{item.name}</a>
          </li>
        ))}
        
        <div class="mt-6 pt-4 bg-background-alt rounded-lg p-4">
            <span class="text-sm text-text-muted font-bold mb-2 block uppercase tracking-widest">Extras</span>
            {dropdownItems.map(item => (
            <li>
                <a href={item.href} class="block py-3 text-text-muted hover:text-text-link normal-case">{item.name}</a>
            </li>
            ))}
        </div>
      </ul>
    </nav>
  </div>

</header>

<script>
  // 1. Live Date
  (function () {
    const el = document.getElementById("oy-current-date");
    if (!el) return;
    const now = new Date();
    const opts = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
    el.textContent = now.toLocaleDateString(undefined, opts);
  })();

  
  // Mobile Menu
  const btn = document.getElementById("oy-hamburger");
  const menu = document.getElementById("mobile-menu");
  const header = document.getElementById("main-header");
  
  if (btn && menu && header) {
    // Position menu exactly under header
    const headerHeight = header.offsetHeight;
    menu.style.top = `${headerHeight}px`;

    btn.addEventListener("click", () => {
      menu.classList.toggle("hidden");
      
      // Animate Icon
      btn.classList.toggle("open");
      const spans = btn.querySelectorAll("span");
      if (btn.classList.contains("open")) {
        spans[0].style.transform = "rotate(45deg) translate(5px, 5px)";
        spans[1].style.opacity = "0";
        spans[2].style.transform = "rotate(-45deg) translate(5px, -5px)";
        document.body.style.overflow = "hidden"; // Lock Page Scroll
      } else {
        spans[0].style.transform = "none";
        spans[1].style.opacity = "1";
        spans[2].style.transform = "none";
        document.body.style.overflow = ""; // Unlock Page Scroll
      }
    });
  }

</script>

<style>
  :root {
    --side-margin: 120px;
    --gutter: 24px;
  }

  /* --- HEADER (FIXED) --- */
  .oy-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 120;
    background: var(--color-bg-primary);
    box-shadow: 0 1px 0 rgba(0,0,0,0.03);
  }

  /* ... (Your existing Head Bar styles - Unchanged) ... */
  .head-bar { background: var(--color-bg-primary); color: var(--color-text-secondary); font-family: var(--font-body); font-size: var(--font-paragraph-size); }
  .head-inner { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; justify-content: space-between; padding: 18px 0; }
  .date-left { display: flex; align-items: center; gap: 12px; }
  .icon-world { width: 18px; height: 18px; opacity: 0.9 }
  .date-text { color: var(--color-text-secondary); }
  .brand { grid-column: 2 / 3; display:flex; align-items:center; gap: 18px; justify-self:center; }
  .brand-logo { width: 200px; height: auto; display:block; }
  .right-actions { justify-self: end; display: flex; align-items: center; gap: 12px; }
  
  .utility-link {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--color-text-primary);
    text-decoration: none;
    transition: color 0.15s ease;
  }
  .utility-link:hover { color: var(--color-base-red-942414); }

  .hamburger {
    display: none;
    background: none;
    border: none;
    width: 40px;
    height: 34px;
    padding: 6px;
    flex-direction: column;
    justify-content: space-between;
    gap: 4px;
    cursor: pointer;
  }
  .hamburger span { display: block; height: 3px; background: var(--color-text-primary); border-radius: 3px; }

  /* --- NAV BAND --- */
  .nav-band {
    background: #e5e5e5;
    border-top: 1px solid var(--color-divider);
    border-bottom: 1px solid var(--color-divider);
  }
  .nav-inner { padding: 12px 0; }
  .main-nav { width: 100%; }
  
  .nav-list {
    display: flex;
    gap: calc(var(--gutter));
    align-items: center;
    justify-content: center;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .nav-item { }
  .nav-link {
    text-decoration: none;
    color: var(--color-text-primary);
    font-family: var(--font-body-sm-family);
    font-size: var(--font-body-sm-size);
    font-weight: 400;
    padding: 6px 2px;
    transition: color .15s ease;
  }
  .nav-item.active .nav-link, .nav-link:hover { color: var(--color-base-red-942414); font-weight: 600; }

  /* --- DROPDOWN (Desktop) --- */
  .dropdown-container { position: relative; }
  .dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 240px;
    background: var(--color-bg-primary);
    border: 1px solid var(--color-divider);
    border-top: none;
    box-shadow: var(--shadow-soft);
    z-index: 100;
    list-style: none;
    padding: 8px;
    margin: 0;
  }
  .dropdown-item { width: 100%; }
  .dropdown-item .nav-link { width: 100%; display: block; padding: 8px 12px; border-radius: 4px; }
  .dropdown-item .nav-link:hover, .dropdown-item.active .nav-link { background: var(--color-bg-alt); color: var(--color-base-red-942414); }
  .dropdown-container:hover .dropdown-menu { display: block; }

  /* --- MOBILE STYLES --- */
  @media (max-width: 980px) {
    :root { --side-margin: 24px; } 
    .head-inner { grid-template-columns: 1fr auto; padding-block: 8px; }
    .brand { grid-column: 1 / 2; justify-self: start; }
    .right-actions { justify-self: end; }
    .hamburger { display: inline-flex; }
    .brand-logo { width: 120px; height: auto; display:block; }
    .utility-link { display: none; } /* Hide 'Submit' on mobile header to save space */

    /* 1. Hide Desktop Nav List */
    .nav-list { display: none; }
    .nav-inner { padding: 0px; }

    /* 2. Mobile Menu Container (When Open) */
    .nav-band.open {
      /* This is just a flag class now, handled by inner logic */
    }

    /* 3. âœ… THE SCROLL FIX: The List becomes the scrollable container */
    .nav-band.open .nav-list {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      
      /* Fixed Position: Fills the screen below the header */
      position: fixed;
      top: var(--header-height, 60px); /* Calculated by JS */
      bottom: 0;
      left: 0;
      right: 0;
      
      background: var(--color-bg-primary);
      padding: 20px; /* Add padding inside the scroll area */
      
      /* Scroll Logic */
      overflow-y: auto; /* Enable vertical scrolling */
      -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
      
      box-shadow: var(--shadow-soft);
      border-top: 1px solid var(--color-border-default);
      z-index: 110; /* Ensure it sits on top of everything */
    }

    .nav-band.open .nav-item { width: 100%; border-bottom: 1px solid var(--color-bg-alt); }
    .nav-band.open .nav-link { padding: 16px 0; font-size: 18px; display: block; width: 100%; }

    /* Mobile Dropdown Logic (Expand in place) */
    .dropdown-container { width: 100%; }
    .dropdown-container .nav-link { display: flex; justify-content: space-between; align-items: center; }
    
    /* Always show dropdown items in mobile menu for easy access */
    .dropdown-menu {
      display: block; 
      position: static; /* In flow */
      box-shadow: none;
      border: none;
      padding: 0 0 0 20px; /* Indent sub-items */
      background: transparent;
    }
    .dropdown-container .dropdown-trigger { display: none; } /* Hide "More" label */
    .dropdown-item .nav-link { 
      color: var(--color-text-muted); 
      font-size: 16px; 
      padding: 12px 0;
      border-bottom: none;
    }
  }

  @media (min-width: 1440px) {
    .container { max-width: 1400px; margin-left: auto; margin-right: auto; }
  }

  @media (max-width: 768px) {
    body {
      font-size: var(--font-body-sm-size);
      line-height: var(--font-body-sm-line);
      padding-inline: calc(var(--grid-gutter));
    }
    .container { padding-left: 0px; padding-right: 0px; }
    .head-inner { align-items: center; justify-content: space-between; padding-inline: 16px; }
    div.date-left { margin-bottom: 8px; }
    div.container.head-bar { padding-block: 0px; }
    div#oy-nav-band.container.nav-band { padding: 0px; }
  }
</style>