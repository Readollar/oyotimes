---
// src/components/CommunityInsights.astro
import { getCollection } from 'astro:content';
import CardHorizontal from './cards/CardHorizontal.astro';

// 1. Fetch all blog posts
const allPosts = await getCollection('blog');

// 2. Filter for "Insight" category
const insightPosts = allPosts
  .filter(post => post.data.category === "Insight" || post.data.category === "Community's Insight")
  .sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf())
  .slice(0, 6); // Show the latest 6
---

<section class="bg-background-alt py-8 md:py-12">
  <div class="container">
    
    <div class="flex flex-col md:flex-row justify-between md:items-end mb-8 pb-4 border-b border-divider">
      <div>
        <h2 class="font-merri font-bold text-2xl md:text-3xl text-primary">
          Community's Insight
        </h2>
        <div class="w-16 h-1 bg-primary mt-2"></div>
      </div>
      
      <div class="mt-4 md:mt-0">
        <a href="/submit" class="inline-block bg-button-default text-white font-bold py-2 px-4 rounded-md hover:bg-button-hover transition-colors shadow-soft">
          Submit Your Insight &rarr;
        </a>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-8">
      {insightPosts.length > 0 ? (
        insightPosts.map(post => (
          <CardHorizontal
            href={`/blog/${post.slug}/`}
            imgSrc={post.data.heroImage}
            author={post.data.author}
            date={post.data.date}
            title={post.data.title}
            excerpt={post.data.excerpt}
          />
        ))
      ) : (
        <div class="col-span-2 text-center py-12 text-muted italic">
          No community insights yet. <a href="/submit" class="underline text-primary">Be the first to submit one!</a>
        </div>
      )}
    </div>

  </div>
</section>