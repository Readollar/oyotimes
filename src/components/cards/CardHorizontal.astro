---
// src/components/cards/CardHorizontal.astro
import { Fragment } from 'astro:jsx';

export interface Props {
  href: string;
  imgSrc: string;
  author: string;
  date: string;
  title: string;
  excerpt: string;
}
const { href, imgSrc, author, date, title, excerpt } = Astro.props;
---

<a href={href} class="group flex flex-col sm:flex-row gap-4 items-start">
  <div class="shrink-0 w-full sm:w-[196px] h-48 sm:h-[145px] overflow-hidden rounded-md">
    <img 
      src={imgSrc} 
      alt={title} 
      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
    />
  </div>

  <div class="flex-1 min-w-0">
    <p class="text-xs font-bold text-muted uppercase tracking-wide mb-1 flex items-center gap-1">
      {author} 
      <span>&bull;</span> 
      <time class="time-ago" datetime={date}>{date.split('T')[0]}</time>
    </p>
    <h3 class="font-merri font-bold text-lg leading-tight text-primary group-hover:text-link transition-colors mb-2">
      {title}
    </h3>
    <p class="text-sm text-muted line-clamp-3">
      {excerpt}
    </p>
  </div>
</a>

<script>
  import { formatDistanceToNow, parseISO, differenceInDays } from 'date-fns';

  const timeElements = document.querySelectorAll('.time-ago');

  timeElements.forEach(timeEl => {
    const rawDate = timeEl.getAttribute('datetime');
    if (!rawDate) return;

    try {
      // Try to create a Date object
      let date = new Date(rawDate);
      
      // Check if date is valid
      if (isNaN(date.getTime())) {
         throw new Error("Invalid Date");
      }

      const now = new Date();
      const daysDifference = differenceInDays(now, date);

      if (daysDifference <= 7) {
        timeEl.textContent = formatDistanceToNow(date, { addSuffix: true });
      } else {
        // Format as "August 8, 2025"
        timeEl.textContent = date.toLocaleDateString('en-US', {
           year: 'numeric', month: 'long', day: 'numeric'
        });
      }
    } catch (e) {
      console.error("Date error:", e);
      // It will just keep the fallback text which is fine
    }
  });
</script>